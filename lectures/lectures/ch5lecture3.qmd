---
title: Ch 5 Lecture 3
lecture_day: 12 
readings: ""
publish: false
execute: 
  cache: true
lightbox: true
filters:
    - pyodide
kernel: jupyter
format: 
    course-presentation-revealjs:
      css: theorem.css
      code-fold: show
---

# Intuition about SVD

## Thinking again about matrix diagonalization

::: notes
If $A$ is a (non-defective) $n \times n$ square matrix, 

- then we can write it as $A = PDP^{T}$ where $D$ is a diagonal matrix and $P$ is an orthogonal matrix of eigenvectors.

- We can find the product of $A$ with a vector $\mathbf{x}$ where $\mathbf{x}$ is a column vector of length $n$. This product will also be a column vector of length $n$.

- What's the intuition behind the diagonalization?

- The matrix $P^{T}$ is a change of basis matrix. It takes a vector $\mathbf{x}$ expressed in the standard basis and expresses it in terms of the basis of eigenvectors of $A$. 
  - This works because $P$ is orthogonal.

- The matrix $D$ is a scaling matrix. It scales the eigenvectors by the corresponding eigenvalues. (If $A$ is not full rank, then $D$ will have some zeros on the diagonal.)

- The matrix $P$ is the inverse of $P^{T}$ (because $P$ is orthogonal). It just takes the scaled eigenvectors and expresses them in terms of the standard basis.
  
- This all works because $P$ is orthogonal and there's a correspondence between the rows of $P^{T}$ and the columns of $P$.


  - This inverse projection is what we want because the columns of $P$ are *eigenvectors* of $A$. 
  - We can see this most easily by imagining that $\mathbf{x}$ is a multiple of one of the eigenvectors.
  - $P\mathbf{x}$ will give the coordinates of $\mathbf{x}$ in the basis of eigenvectors. For instance, if $P\mathbf{x}=\begin{bmatrix} 1 \\0\\ \vdots \\ 0\end{bmatrix}$, we know that $\mathbf{x}$ equals the first eigenvector.
    - After multiplication by the diagonal matrix, we'll just have $\begin{bmatrix} \lambda_{1} \\0\\ \vdots \\ 0\end{bmatrix}$.
  - Then $P^{T}$ will take this back to a multiple of the first eigenvector, back in the standard basis.
  - That's what we want *because* we are supposing that $\mathbf{x}$ is a multiple of the first eigenvector.
  - The same logic will hold when $\mathbf{x}$ is weighted sum of the eigenvectors.
    - Because $P$ is orthonormal, $P\mathbf{x}$ will give the weights of the eigenvectors in the basis of eigenvectors.
  -  $P^{T}$ will take it back to the weighted sum of the eigenvectors in the standard basis, with the new weights being determined by the original weights and the eigenvalues.
-  This will all works when $U$ and $V$ are orthogonal and there's a correspondence between the rows of $V^{T}$ and the columns of $U$.
  
  

When we have some zeros on the diagonal, multiplying by $D$ is a *projection* of $\mathbf{x}$ onto the row space of $A$. We are removing the components of $\mathbf{x}$ that are in the null space of $A$.
:::

## The same logic, applied to a general matrix

::: notes
If $A$ is a  <span style="color:red">$m \times n$</span> square matrix, 

- then we can write it as <span style="color:red">$A = U\Sigma V^{T}$</span> where $\Sigma$ is a diagonal matrix and $P$ is an orthogonal matrix of eigenvectors.

- We can find the product of $A$ with a vector $\mathbf{x}$ where $\mathbf{x}$ is a column vector of length $n$. This product will now be a column vector of length <span style="color:red">$m$</span>.

- The matrix $V^{T}$ is a change of basis matrix. It takes a vector $\mathbf{x}$ expressed in the standard basis and expresses it in terms of the basis of <span style="color:red">*right singular vectors*</span> of $A$.

- The matrix <span style="color:red">$\Sigma$</span> is a scaling matrix. It scales the singular vectors by the corresponding <span style="color:red">singular values</span>. (If <span style="color:red">$A$ is not square or $A$ is not full rank</span>, then $\Sigma$ will have some zeros on the diagonal.)

- The matrix $U$ <span style="color:red">is *not* generally</span> the inverse of $V^{T}$. It takes the scaled singular vectors and expresses them in terms of the standard basis <span style="color:red">of $\mathbb{R}^m$</span>.

   -  Specifically, the first column of $U$ must be the correct vector to express the first row of $V^{T}$ in $\mathbbb{R}^m$
- 
   -  that is, we need the first column of $U$ to be $A\mathbf{v}_1$ (divided by the scaling factor).
   - This is because $\Sigma V^{T}\mathbf{v}_1=\sigma_1\begin{bmatrix} 1 \\0\\ \vdots \\ 0\end{bmatrix}$, so that $U\Sigma V^{T}\mathbf{v}_1=\sigma_1 U \begin{bmatrix} 1 \\0\\ \vdots \\ 0\end{bmatrix}=\sigma_1\mathbf{u_1}$.
   - So we'd better have $\mathbf{u_1}=A\mathbf{v}_1/\sigma_1$.
 :::

 ## SVD

 ::: notes
- Assume $m \geq n$ (the case $m<n$ is similar).
- Let $B=A^{T} A$ and let $\lambda_{1} \geq \lambda_{2} \geq \cdots \geq \lambda_{n}$ be the eigenvalues of $B$.
- Find the basis of eigenvectors of $B$: $B \mathbf{v}_{k}=\sigma_{k}^{2} \mathbf{v}_{k}, k=1,2, \ldots, n$
- Let $V=\left[\mathbf{v}_{1}, \mathbf{v}_{2}, \ldots, \mathbf{v}_{n}\right]$. Then $V$ is an orthogonal $n \times n$ matrix.
-  We may assume for some index $r$ that $\sigma_{r+1}, \sigma_{r+2}, \ldots, \sigma_{n}$ are zero, while $\sigma_{r} \neq 0$.
-  Next set $\mathbf{u}_{j}=\frac{1}{\sigma_{j}} A \mathbf{v}_{j}, j=1,2, \ldots, r$. 
-  In other words, $\mathbf{u}_{j}$ is the vector that you get when you transform $\mathbf{v}_{j}$ by $A$ and then normalize it by the singular value $\sigma_{j}$.
-  These are orthonormal vectors in $\mathbb{R}^{m}$ since

$$
\mathbf{u}_{j}^{T} \mathbf{u}_{k}=\frac{1}{\sigma_{j} \sigma_{k}} \mathbf{v}_{j}^{T} A^{T} A \mathbf{v}_{k}=\frac{1}{\sigma_{j} \sigma_{k}} \mathbf{v}_{j}^{T} B \mathbf{v}_{k}=\frac{\sigma_{k}^{2}}{\sigma_{j} \sigma_{k}} \mathbf{v}_{j}^{T} \mathbf{v}_{k}= \begin{cases}0, & \text { if } j \neq k \\ 1, & \text { if } j=k\end{cases}
$$

- Now expand this set to an orthonormal basis $\mathbf{u}_{1}, \mathbf{u}_{2}, \ldots, \mathbf{u}_{m}$ of $\mathbb{R}^{m}$. This is possible by Theorem 4.7 in Section 4.3. Set $U=\left[\mathbf{u}_{1}, \mathbf{u}_{2}, \ldots, \mathbf{u}_{m}\right]$. This matrix is orthogonal. We calculate that if $k>r$, then $\mathbf{u}_{j}^{T} A \mathbf{v}_{k}=0$ since $A \mathbf{v}_{k}=\mathbf{0}$, and if $k<r$, then

$$
\mathbf{u}_{j}^{T} A \mathbf{v}_{k}=\sigma_{k} \mathbf{u}_{j}^{T} \mathbf{u}_{k}=\left\{\begin{array}{l}
0, \text { if } j \neq k, \\
\sigma_{k}, \text { if } j=k
\end{array}\right.
$$



$U^{T} A V=\left[\mathbf{u}_{j}^{T} A \mathbf{v}_{k}\right]=\Sigma$, which is the desired SVD.

And because $U$ and $V$ are orthonormal, their inverses are their transposes, so $A=U \Sigma V^{T}$.

Note also that we can find $U$ as the eigenvectors of $A A^{T}$ and $V$ as the eigenvectors of $A^{T} A$.

:::

## Recap


$$
A=U S V^{T}
$$

where




$$
\begin{array}{lccc}
 & & & U & V 
& S \\
& & &\left(\begin{array}{ccc}
\mid & & \mid \\
\mathbf{u}_{1} & \cdots & \mathbf{u}_{m} \\
\mid & & \mid
\end{array}\right) &\left(\begin{array}{ccc}
\mid & & \mid \\
\mathbf{v}_{1} & \cdots & \mathbf{v}_{n} \\
\mid & & \mid
\end{array}\right) &\left(\begin{array}{cccc}
\sigma_1 & & & \\
& \sigma_2 & \\  & & \ddots & \\
& & &  \sigma_r & \\ & & & & \ddots \\ & & & & & 0

\end{array}\right)\\
\text{eigenvectors of} & & & A A^{T}  & A^{T} A \\
\end{array}
$$


eigenvectors of $\mathrm{AA}^{\mathrm{T}}$

$\mathrm{A}^{\mathrm{T}} \mathrm{A}$


## Example


$$
A=\left(\begin{array}{ccc}
3 & 2 & 2 \\
2 & 3 & -2
\end{array}\right)
$$

. . .

$$
A A^{T}=\left(\begin{array}{cc}
17 & 8 \\
8 & 17
\end{array}\right), \quad A^{T} A=\left(\begin{array}{ccc}
13 & 12 & 2 \\
12 & 13 & -2 \\
2 & -2 & 8
\end{array}\right)
$$

##


$$
\begin{array}{cc}
A A^{T}=\left(\begin{array}{cc}
17 & 8 \\
8 & 17
\end{array}\right) & A^{T} A=\left(\begin{array}{ccc}
13 & 12 & 2 \\
12 & 13 & -2 \\
2 & -2 & 8
\end{array}\right) \\
\begin{array}{c}
\text { eigenvalues: } \lambda_{1}=25, \lambda_{2}=9 \\
\text { eigenvectors }
\end{array} & \begin{array}{c}
\text { eigenvalues: } \lambda_{1}=25, \lambda_{2}=9, \lambda_{3}=0 \\
\text { eigenvectors }
\end{array} \\
u_{1}=\binom{1 / \sqrt{2}}{1 / \sqrt{2}} \quad u_{2}=\binom{1 / \sqrt{2}}{-1 / \sqrt{2}} & v_{1}=\left(\begin{array}{c}
1 / \sqrt{2} \\
1 / \sqrt{2} \\
0
\end{array}\right) \quad v_{2}=\left(\begin{array}{c}
1 / \sqrt{18} \\
-1 / \sqrt{18} \\
4 / \sqrt{18}
\end{array}\right) \quad v_{3}=\left(\begin{array}{c}
2 / 3 \\
-2 / 3 \\
-1 / 3
\end{array}\right)
\end{array}
$$

##

SVD decomposition of $A$:
$$
A=U S V^{T}=\left(\begin{array}{cc}
1 / \sqrt{2} & 1 / \sqrt{2} \\
1 / \sqrt{2} & -1 / \sqrt{2}
\end{array}\right)\left(\begin{array}{ccc}
5 & 0 & 0 \\
0 & 3 & 0
\end{array}\right)\left(\begin{array}{rrr}
1 / \sqrt{2} & 1 / \sqrt{2} & 0 \\
1 / \sqrt{18} & -1 / \sqrt{18} & 4 / \sqrt{18} \\
2 / 3 & -2 / 3 & -1 / 3
\end{array}\right)
$$

## Reformulating SVD

Since matrix $V$ is orthogonal, $V^{I} V$ equals $I$. We can rewrite the SVD equation as:

$$
\begin{aligned}
& A=U S V^{T} \\
& A V=U S
\end{aligned}
$$

This equation establishes an important relationship between $u_{i}$ and $v_{i}$.

Recall

$$
A B=\left[\begin{array}{llll}
A b_{1} & A b_{2} & \ldots & A b_{n}
\end{array}\right]
$$

Apply $A V=U S$,

![](https://cdn.mathpix.com/cropped/2024_05_01_1b1bef8a8bd39ab29098g-10.jpg?height=309&width=1501&top_left_y=867&top_left_x=282)

![](https://cdn.mathpix.com/cropped/2024_05_01_1b1bef8a8bd39ab29098g-10.jpg?height=265&width=770&top_left_y=1212&top_left_x=686)

##
$$
\begin{aligned}
& =\left(\begin{array}{c}
u_{11} \\
\vdots \\
u_{1 m}
\end{array}\right) \sigma_{1} \\
& A v_{1}=\sigma_{1} u_{1}
\end{aligned}
$$

This can be generalized as

$$
A v_{i}=\sigma_{i} u_{i}
$$

Recall,

![](https://cdn.mathpix.com/cropped/2024_05_01_1b1bef8a8bd39ab29098g-11.jpg?height=207&width=841&top_left_y=54&top_left_x=653)

and

$$
\left(\begin{array}{ccc}
\begin{array}{c}
\mid \\
u_{1} \\
\mid
\end{array} & \ldots &
\begin{array}{c}
\mid \\
u_{n} \\
\mid
\end{array}
\end{array}\right)\left(\begin{array}{c}
-v_{l}- \\
\vdots \\
-v_{n}-
\end{array}\right)=\left(\begin{array}{c}
\mid \\
u_{1} \\
\mid
\end{array}\right)\left(-v_{l} \textrm{---}\right)+\ldots+\left(\begin{array}{c}
\mid \\
u_{n} \\
\mid
\end{array}\right)\left(-v_{n} \textrm{---}\right)
$$

The SVD decomposition can be recognized as a series of outer products of $u_{i}$ and $v_{i}$.

$$
A=\sigma_{l} u_{l} v_{l}^{T}+\ldots+\sigma_{r} u_{r} v_{r}^{T}
$$

##




Start with Figure 5.12.1 from Meyer.

Awesome explanation of PCA [here](https://stats.stackexchange.com/questions/2691/making-sense-of-principal-component-analysis-eigenvectors-eigenvalues/140579#140579)

Where does the covariance matrix come in? This explanation [here](https://stats.stackexchange.com/questions/2691/making-sense-of-principal-component-analysis-eigenvectors-eigenvalues/140579#140579) the one that starts "I can give you an explanation".

> As for the mean of the projections, let's observe that $v$ is part of some orthogonal basis of our space, and that if we project our data points on every vector of that basis, their sum will cancel out (it's like that because projecting on the vectors from the basis is like writing the data points in the new orthogonal basis). So the sum of all the projections on the vector $v$ (let's call the sum $S_v$) and the sum of projections on other vectors from the basis (let's call it $S_o$) is 0, because it's the mean of the data points. But $S_v$ is orthogonal to $S_o$! That means $S_o = S_v = 0$.
> 
> **So the mean of our projections is $0$.** Well, that's convenient, because that means the variance is just the sum of squares of lengths of projections, or in symbols 
> $$
> \sum_{i=1}^M (x_i' \cdot v)^2 = \sum_{i=1}^M v^T \cdot x_i'^T \cdot x_i' \cdot v =  v^T \cdot (\sum_{i=1}^M x_i'^T \cdot x_i) \cdot v.
>  $$
> 
> **Well well, suddenly the covariance matrix popped out.** Let's denote it simply by $X$. It means we are now looking for a unit vector $v$ that maximizes $v^T \cdot X \cdot v$, for some semi-positive definite matrix $X$.

## pseudoinverse

We can simply note that the least squares solution we found earlier can be written in a simple way in terms of the SVD matrices.

[Here](https://www.cantorsparadise.com/demystifying-the-moore-penrose-generalized-inverse-a1b989a1dd49) is a decent writeup.

##
Here is what $A$ does to a vector $\mathbf{x}$: first, $V$ expresses $\mathbf{x}$ in terms of the orthonormal basis of the column space of $A$. Then $\Sigma$ scales the components of $\mathbf{x}$ according to the singular values. Finally, $U^{T}$ rotates the scaled components from the basis of the row space of $A$ to express them in terms of the standard basis.

Remember $A$ will take a column vector  $x$ from the row space of $A$ to the column space of $A$. (Actually, first it will project it onto the row space, then it will transform it, and the product $A\mathbf{x}$ will be in the column space. The V is a basis for the whole space, but the first $r$ vectors are an orthonormal basis for the row space, and the r+1 up to n vectors are an orthonormal basis for the null space. Because these last singular values are 0, the corresponding vectors in V are not used in the transformation.)

 The SVD is a way to express this transformation in terms of a simple scaling followed by a rotation.

For the spectral decomposition, you express $x$ in terms of a particular basis that has a very simple action of the matrix -- each element just gets multiplied by the eigenvalues. Then you just go back to the standard basis, using the inverse of the matrix of eigenvectors. (Since this is orthogonal, it's just the transpose.)

For the SVD, you first express $x$ in terms of the special basis where the action of the matrix is to multiply each element by the corresponding singular value. Then you express the result in terms of the standard basis. But because the row space and column space are not the same, you need two different bases for where you start and when you finish, and so you need two different matrices to go back to the standard basis.



... We want to find vectors $\mathbf{v}_1$ and $\mathbf{v}_2$ in the row space $\mathbb{R}^2, \mathbf{u}_1$ and $\mathbf{u}_2$ in the column space $\mathbb{R}^2$, and positive numbers $\sigma_1$ and $\sigma_2$ so that the $\mathbf{v}_i$ are orthonormal, the $\mathbf{u}_i$ are orthonormal, and the $\sigma_i$ are the scaling factors for which $A \mathbf{v}_i=\sigma_i u_i$.

From [here](https://ocw.mit.edu/courses/18-06sc-linear-algebra-fall-2011/d273f75ee2552a5c3c35ccab37e5edce_MIT18_06SCF11_Ses3.5sum.pdf)
