<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Stat 24320 - Turing Patterns</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Turing Patterns</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Adapted from <a href="https://github.com/ijmbarr/turing-patterns/blob/master/LICENSE">ijmbarr</a></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="http://www.degeneratestate.org/static/turing-patterns/title.png" class="img-fluid figure-img"></p>
<figcaption>title</figcaption>
</figure>
</div>
<section id="turing-patterns" class="level1">
<h1><em>Turing Patterns</em></h1>
<p>In 1952, <a href="https://en.wikipedia.org/wiki/Alan_Turing">Turing</a> published a paper called <a href="http://www.dna.caltech.edu/courses/cs191/paperscs191/turing.pdf">“The Chemical Basis of Morphogenesis”</a> suggesting a possible mechanism for how a simple set of chemical reactions could lead to the formation of stripes, spots and other patterns we see on animals. It is a surprisingly readable paper that covers some maths, some chemistry, some numerical modelling and ties it all together to try and answer a biological question.</p>
<p>At the core of the paper are a set of partial differential equations known as <a href="https://en.wikipedia.org/wiki/Reaction%E2%80%93diffusion_system">reaction-diffusion equations</a>. Turing’s analysis shows that in certain regimes systems that obey these equations are unstable to small perturbations, leading to the growth of large scale patterns.</p>
<p>If you have only a basic understanding of chemistry (like I do) this might be surprising. Most chemical reactions I’ve seen involve homogeneous concentrations of reagents, reacting to create the final products, often described by a reaction equation like</p>
<p><span class="math inline">\(A + B \rightarrow C + D\)</span></p>
<p>In this simplified model there is no room for pattern formation, because haven’t included any description about how concentrations of the different chemicals vary in space. Once we take into account these differences, a much richer set of behaviours is possible.</p>
<p>In this post, I am going explore the system described in the paper.</p>
<section id="reaction-diffusion-equations" class="level2">
<h2 class="anchored" data-anchor-id="reaction-diffusion-equations"><em>Reaction Diffusion Equations</em></h2>
<p>Reaction-Diffusion equations are a class of partial differential equations whose dynamics are governed by two terms: a diffusion part and a reaction part. We will be looking at the two component case, which takes the form</p>
<p><span class="math inline">\(\frac{\partial a(x,t)}{\partial t} = D_{a}\frac{\partial^{2} a(x,t)}{\partial x^{2}} + R_{a}(a(x,t),b(x,t))\)</span></p>
<p><span class="math inline">\(\frac{\partial b(x,t)}{\partial t} = D_{b}\frac{\partial^{2} b(x,t)}{\partial x^{2}} + R_{b}(a(x,t),b(x,t))\)</span></p>
<p>Where the <span class="math inline">\(a(x,t)\)</span> and <span class="math inline">\(b(x,t)\)</span> describe the concentration of chemicals <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> at position <span class="math inline">\(x\)</span> and time <span class="math inline">\(t\)</span>. The functions <span class="math inline">\(R_{a}\)</span> and <span class="math inline">\(R_{b}\)</span> determine how the concentrations change due to interspecies reactions and <span class="math inline">\(D_{a}\)</span> and <span class="math inline">\(D_{b}\)</span> are the diffusion coefficients.</p>
<section id="diffusion" class="level3">
<h3 class="anchored" data-anchor-id="diffusion"><em>Diffusion</em></h3>
<p>The diffusion part of the equations causes areas of high concentration to spread out to areas of low concentration, while conserving the total amount of the chemical. To get a feel for what’s happening, let’s focus the equation</p>
<p>$ = D_{a} $</p>
<p>If this looks familiar, it is because it appears in a number of different areas of science and maths. A few are: the <a href="https://en.wikipedia.org/wiki/Diffusion_equation">diffusion equation</a>, the <a href="https://en.wikipedia.org/wiki/Heat_equation">heat equation</a> and <a href="https://en.wikipedia.org/wiki/Brownian_motion">Brownian motion</a>.</p>
<p>It has an analytic solution, which for initial Gaussian distribution is</p>
<p>$ a(x,t) = (-)$</p>
<p>A “spreading out”, or diffusion over time, as the name suggests.</p>
</section>
<section id="simulating-equations" class="level3">
<h3 class="anchored" data-anchor-id="simulating-equations"><em>Simulating equations</em></h3>
<p>If you’ve got this far, you might have noticed that this is written in a <a href="http://jupyter.org/">jupyter notebook</a>. This allows us to mix code with writing, so we don’t just have to look at an equation to understand how it behaves - we can simulate it directly.</p>
<p>To simulate the PDEs, I’m going to use the <a href="https://en.wikipedia.org/wiki/Finite_difference_method#Example:_The_heat_equation">explicit finite-difference method</a>. It is not the best numerical method to use, but it is easy to code, and provided we keep the time step small enough it will be stable.</p>
<p>Under this scheme, we approximate the time derivative as</p>
<p><span class="math display">\[
\frac{\partial a(x,t)}{\partial t} \approx \frac{1}{dt}(a_{x,t+1} - a_{x,t})
\]</span></p>
<p>And the spatial part of the derivative (which is usually know as the <a href="https://en.wikipedia.org/wiki/Laplace_operator">Laplacian</a>) as</p>
<p><span class="math display">\[
\frac{\partial^{2} a(x,t)}{\partial x^{2}} \approx \frac{1}{dx^{2}}(a_{x+1,t} + a_{x-1,t} - 2a_{x,t})
\]</span></p>
<p>Putting it all together, for the diffusion part of the equation we get.</p>
<p><span class="math display">\[
a_{x,t+1} = a_{x,t} + dt\left(  \frac{D_{a}}{dx^{2}}(a_{x+1,t} + a_{x-1,t} - 2a_{x,t})  \right)
\]</span></p>
<p>Let’s start by defining some functions to take care of the spatial derivatives. We will be using periodic boundary conditions throughout our exploration, which are easy to implement in numpy using its <a href="https://docs.scipy.org/doc/numpy-1.12.0/reference/generated/numpy.roll.html">roll</a> function.</p>
<div id="cell-5" class="cell" data-executioninfo="{&quot;elapsed&quot;:3799,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1711136689066,&quot;user&quot;:{&quot;displayName&quot;:&quot;Kendra Burbank&quot;,&quot;userId&quot;:&quot;04974670608065921752&quot;},&quot;user_tz&quot;:300}" data-execution_count="6">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> httpimport</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> httpimport.github_repo(<span class="st">'ijmbarr'</span>,<span class="st">'turing-patterns'</span>):</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> tutils</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># I'm using seaborn for it's fantastic default styles</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">"whitegrid"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>load_ext autoreload</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>autoreload <span class="dv">2</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tutils <span class="im">import</span> BaseStateSystem</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-6" class="cell" data-executioninfo="{&quot;elapsed&quot;:361,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1711136710488,&quot;user&quot;:{&quot;displayName&quot;:&quot;Kendra Burbank&quot;,&quot;userId&quot;:&quot;04974670608065921752&quot;},&quot;user_tz&quot;:300}" data-execution_count="7">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> laplacian1D(a, dx):</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> <span class="dv">2</span> <span class="op">*</span> a</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> np.roll(a,<span class="dv">1</span>,axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> np.roll(a,<span class="op">-</span><span class="dv">1</span>,axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">/</span> (dx <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> laplacian2D(a, dx):</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> <span class="dv">4</span> <span class="op">*</span> a</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> np.roll(a,<span class="dv">1</span>,axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> np.roll(a,<span class="op">-</span><span class="dv">1</span>,axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> np.roll(a,<span class="op">+</span><span class="dv">1</span>,axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> np.roll(a,<span class="op">-</span><span class="dv">1</span>,axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">/</span> (dx <span class="op">**</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To aid in generating visualisations, I’ve written a base class which updates and plots a system based on some notion of state. There’s nothing specific about the reaction diffusion equations encoded in it, so I’m not going to go into any detail about it. You can find the full code for it, along with this notebook on github <a href="https://github.com/ijmbarr/turing-patterns">here</a>. It uses <a href="http://matplotlib.org/api/animation_api.html">matplotlib’s animation</a> functionality to plot the output as a gif.</p>
<p>All together we can simulate the effect of the diffusion equation:</p>
<div id="cell-8" class="cell" data-executioninfo="{&quot;elapsed&quot;:10070,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1711136724113,&quot;user&quot;:{&quot;displayName&quot;:&quot;Kendra Burbank&quot;,&quot;userId&quot;:&quot;04974670608065921752&quot;},&quot;user_tz&quot;:300}" data-outputid="734b3788-415b-4d31-fc9a-2e381cebc277" data-execution_count="8">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> OneDimensionalDiffusionEquation(BaseStateSystem):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, D):</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.D <span class="op">=</span> D</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.width <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.dx <span class="op">=</span> <span class="dv">10</span> <span class="op">/</span> <span class="va">self</span>.width</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.dt <span class="op">=</span> <span class="fl">0.9</span> <span class="op">*</span> (<span class="va">self</span>.dx <span class="op">**</span> <span class="dv">2</span>) <span class="op">/</span> (<span class="dv">2</span> <span class="op">*</span> D)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.steps <span class="op">=</span> <span class="bu">int</span>(<span class="fl">0.1</span> <span class="op">/</span> <span class="va">self</span>.dt)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> initialise(<span class="va">self</span>):</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.t <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.X <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">5</span>,<span class="dv">5</span>,<span class="va">self</span>.width)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.a <span class="op">=</span> np.exp(<span class="op">-</span><span class="va">self</span>.X<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> update(<span class="va">self</span>):</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.steps):</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.t <span class="op">+=</span> <span class="va">self</span>.dt</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._update()</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _update(<span class="va">self</span>):</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>        La <span class="op">=</span> laplacian1D(<span class="va">self</span>.a, <span class="va">self</span>.dx)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>        delta_a <span class="op">=</span> <span class="va">self</span>.dt <span class="op">*</span> (<span class="va">self</span>.D <span class="op">*</span> La)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.a <span class="op">+=</span> delta_a</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> draw(<span class="va">self</span>, ax):</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>        ax.clear()</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>        ax.plot(<span class="va">self</span>.X,<span class="va">self</span>.a, color<span class="op">=</span><span class="st">"r"</span>)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>        ax.set_ylim(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>        ax.set_xlim(<span class="op">-</span><span class="dv">5</span>,<span class="dv">5</span>)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>        ax.set_title(<span class="st">"t = </span><span class="sc">{:.2f}</span><span class="st">"</span>.<span class="bu">format</span>(<span class="va">self</span>.t))</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>one_d_diffusion <span class="op">=</span> OneDimensionalDiffusionEquation(D<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>one_d_diffusion.plot_time_evolution(<span class="st">"diffusion.gif"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>MovieWriter imagemagick unavailable; using Pillow instead.</code></pre>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="http://www.degeneratestate.org/static/turing-patterns/diffusion.gif" class="img-fluid figure-img"></p>
<figcaption>diffusion</figcaption>
</figure>
</div>
<p>As expected - the diffusion equation causes the the concentration to “spread out”.</p>
</section>
<section id="reaction" class="level3">
<h3 class="anchored" data-anchor-id="reaction"><em>Reaction</em></h3>
<p>Interactions between the two chemical components are introduced via the functions <span class="math inline">\(R_{a}\)</span> and <span class="math inline">\(R_{b}\)</span>. These functions only depend on the local concentration of each of the chemicals. Their exact form will depend on the chemicals involved, but it is possible to show that Turing patterns are observed for a whole class of different equations.</p>
<p>The one thing we will require from these equations is that they reach a stable equilibrium when the concentrations of the chemicals involved are completely homogeneous. This means that there exists concentrations of <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> such that</p>
<p><span class="math inline">\(R_a(a_{0}, b_{0}) = 0\)</span></p>
<p><span class="math inline">\(R_{b}(a_{0}, b_{0}) = 0\)</span></p>
<p>The fact that we require this to hold will make the later instability more suprising.</p>
<p>For the reaction equations, I’m going to use the <a href="https://en.wikipedia.org/wiki/FitzHugh%E2%80%93Nagumo_model">FitzHugh–Nagumo equation</a></p>
<p><span class="math inline">\(R_a(a, b) = a - a^{3} - b + \alpha\)</span></p>
<p><span class="math inline">\(R_{b}(a, b) = \beta (a - b)\)</span></p>
<p>Where <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> are constants.</p>
<p>Let’s see how it behaves</p>
<div id="cell-11" class="cell" data-executioninfo="{&quot;elapsed&quot;:12554,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1711136742819,&quot;user&quot;:{&quot;displayName&quot;:&quot;Kendra Burbank&quot;,&quot;userId&quot;:&quot;04974670608065921752&quot;},&quot;user_tz&quot;:300}" data-outputid="cf75c321-b543-4239-c5c0-95997cef6ffc" data-execution_count="9">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ReactionEquation(BaseStateSystem):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, Ra, Rb):</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.Ra <span class="op">=</span> Ra</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.Rb <span class="op">=</span> Rb</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.dt <span class="op">=</span> <span class="fl">0.01</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.steps <span class="op">=</span> <span class="bu">int</span>(<span class="fl">0.1</span> <span class="op">/</span> <span class="va">self</span>.dt)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> initialise(<span class="va">self</span>):</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.t <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.a <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.b <span class="op">=</span> <span class="fl">0.7</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.Ya <span class="op">=</span> []</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.Yb <span class="op">=</span> []</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.X <span class="op">=</span> []</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> update(<span class="va">self</span>):</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.steps):</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.t <span class="op">+=</span> <span class="va">self</span>.dt</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._update()</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _update(<span class="va">self</span>):</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>        delta_a <span class="op">=</span> <span class="va">self</span>.dt <span class="op">*</span> <span class="va">self</span>.Ra(<span class="va">self</span>.a,<span class="va">self</span>.b)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>        delta_b <span class="op">=</span> <span class="va">self</span>.dt <span class="op">*</span> <span class="va">self</span>.Rb(<span class="va">self</span>.a,<span class="va">self</span>.b)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.a <span class="op">+=</span> delta_a</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.b <span class="op">+=</span> delta_b</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> draw(<span class="va">self</span>, ax):</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>        ax.clear()</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.X.append(<span class="va">self</span>.t)</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.Ya.append(<span class="va">self</span>.a)</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.Yb.append(<span class="va">self</span>.b)</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>        ax.plot(<span class="va">self</span>.X,<span class="va">self</span>.Ya, color<span class="op">=</span><span class="st">"r"</span>, label<span class="op">=</span><span class="st">"A"</span>)</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>        ax.plot(<span class="va">self</span>.X,<span class="va">self</span>.Yb, color<span class="op">=</span><span class="st">"b"</span>, label<span class="op">=</span><span class="st">"B"</span>)</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>        ax.legend()</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>        ax.set_ylim(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>        ax.set_xlim(<span class="dv">0</span>,<span class="dv">5</span>)</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>        ax.set_xlabel(<span class="st">"t"</span>)</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>        ax.set_ylabel(<span class="st">"Concentrations"</span>)</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>alpha, beta <span class="op">=</span>  <span class="fl">0.2</span>, <span class="dv">5</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Ra(a,b): <span class="cf">return</span> a <span class="op">-</span> a <span class="op">**</span> <span class="dv">3</span> <span class="op">-</span> b <span class="op">+</span> alpha</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Rb(a,b): <span class="cf">return</span> (a <span class="op">-</span> b) <span class="op">*</span> beta</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>one_d_reaction <span class="op">=</span> ReactionEquation(Ra, Rb)</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>one_d_reaction.plot_time_evolution(<span class="st">"reaction.gif"</span>, n_steps<span class="op">=</span><span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>MovieWriter imagemagick unavailable; using Pillow instead.</code></pre>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="http://www.degeneratestate.org/static/turing-patterns/reaction.gif" class="img-fluid figure-img"></p>
<figcaption>reaction</figcaption>
</figure>
</div>
<p>The system is stable, and stabilises to <span class="math inline">\(a = b = \sqrt[3]{\alpha}\)</span>.</p>
</section>
</section>
<section id="full-model" class="level2">
<h2 class="anchored" data-anchor-id="full-model"><em>Full Model</em></h2>
<p>We now have two parts to the reaction diffusion equation: a diffusion term that “spreads” out concentration and a reaction part the equalises the two concentrations. It feels like these two together should create a stable system, so it is surprising that we can end up with patterns.</p>
<p>But enough with the preliminaries, let’s take a look at some of the patterns formed.</p>
<div id="cell-14" class="cell" data-executioninfo="{&quot;elapsed&quot;:45228,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1711136795138,&quot;user&quot;:{&quot;displayName&quot;:&quot;Kendra Burbank&quot;,&quot;userId&quot;:&quot;04974670608065921752&quot;},&quot;user_tz&quot;:300}" data-outputid="76d916b5-185b-43ae-aff2-3187e253e099" data-execution_count="10">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> random_initialiser(shape):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>        np.random.normal(loc<span class="op">=</span><span class="dv">0</span>, scale<span class="op">=</span><span class="fl">0.05</span>, size<span class="op">=</span>shape),</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>        np.random.normal(loc<span class="op">=</span><span class="dv">0</span>, scale<span class="op">=</span><span class="fl">0.05</span>, size<span class="op">=</span>shape)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> OneDimensionalRDEquations(BaseStateSystem):</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, Da, Db, Ra, Rb,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>                 initialiser<span class="op">=</span>random_initialiser,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>                 width<span class="op">=</span><span class="dv">1000</span>, dx<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>                 dt<span class="op">=</span><span class="fl">0.1</span>, steps<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.Da <span class="op">=</span> Da</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.Db <span class="op">=</span> Db</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.Ra <span class="op">=</span> Ra</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.Rb <span class="op">=</span> Rb</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.initialiser <span class="op">=</span> initialiser</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.width <span class="op">=</span> width</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.dx <span class="op">=</span> dx</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.dt <span class="op">=</span> dt</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.steps <span class="op">=</span> steps</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> initialise(<span class="va">self</span>):</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.t <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.a, <span class="va">self</span>.b <span class="op">=</span> <span class="va">self</span>.initialiser(<span class="va">self</span>.width)</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> update(<span class="va">self</span>):</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.steps):</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.t <span class="op">+=</span> <span class="va">self</span>.dt</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._update()</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _update(<span class="va">self</span>):</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>        <span class="co"># unpack so we don't have to keep writing "self"</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>        a,b,Da,Db,Ra,Rb,dt,dx <span class="op">=</span> (</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.a, <span class="va">self</span>.b,</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.Da, <span class="va">self</span>.Db,</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.Ra, <span class="va">self</span>.Rb,</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.dt, <span class="va">self</span>.dx</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>        La <span class="op">=</span> laplacian1D(a, dx)</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>        Lb <span class="op">=</span> laplacian1D(b, dx)</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>        delta_a <span class="op">=</span> dt <span class="op">*</span> (Da <span class="op">*</span> La <span class="op">+</span> Ra(a,b))</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>        delta_b <span class="op">=</span> dt <span class="op">*</span> (Db <span class="op">*</span> Lb <span class="op">+</span> Rb(a,b))</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.a <span class="op">+=</span> delta_a</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.b <span class="op">+=</span> delta_b</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> draw(<span class="va">self</span>, ax):</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>        ax.clear()</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>        ax.plot(<span class="va">self</span>.a, color<span class="op">=</span><span class="st">"r"</span>, label<span class="op">=</span><span class="st">"A"</span>)</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>        ax.plot(<span class="va">self</span>.b, color<span class="op">=</span><span class="st">"b"</span>, label<span class="op">=</span><span class="st">"B"</span>)</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>        ax.legend()</span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>        ax.set_ylim(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>        ax.set_title(<span class="st">"t = </span><span class="sc">{:.2f}</span><span class="st">"</span>.<span class="bu">format</span>(<span class="va">self</span>.t))</span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>Da, Db, alpha, beta <span class="op">=</span> <span class="dv">1</span>, <span class="dv">100</span>, <span class="op">-</span><span class="fl">0.005</span>, <span class="dv">10</span></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Ra(a,b): <span class="cf">return</span> a <span class="op">-</span> a <span class="op">**</span> <span class="dv">3</span> <span class="op">-</span> b <span class="op">+</span> alpha</span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Rb(a,b): <span class="cf">return</span> (a <span class="op">-</span> b) <span class="op">*</span> beta</span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>width <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>dx <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> <span class="fl">0.001</span></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>OneDimensionalRDEquations(</span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>    Da, Db, Ra, Rb,</span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span>width, dx<span class="op">=</span>dx, dt<span class="op">=</span>dt,</span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>    steps<span class="op">=</span><span class="dv">100</span></span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>).plot_time_evolution(<span class="st">"1dRD.gif"</span>, n_steps<span class="op">=</span><span class="dv">150</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>MovieWriter imagemagick unavailable; using Pillow instead.</code></pre>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="http://www.degeneratestate.org/static/turing-patterns/1dRD.gif" class="img-fluid figure-img"></p>
<figcaption>reaction</figcaption>
</figure>
</div>
<p>A pattern of stripes.</p>
<p>We can see that same behavior in two dimensions:</p>
<div id="cell-16" class="cell" data-executioninfo="{&quot;elapsed&quot;:11355,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1711137054140,&quot;user&quot;:{&quot;displayName&quot;:&quot;Kendra Burbank&quot;,&quot;userId&quot;:&quot;04974670608065921752&quot;},&quot;user_tz&quot;:300}" data-execution_count="11">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TwoDimensionalRDEquations(BaseStateSystem):</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, Da, Db, Ra, Rb,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                 initialiser<span class="op">=</span>random_initialiser,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                 width<span class="op">=</span><span class="dv">1000</span>, height<span class="op">=</span><span class="dv">1000</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                 dx<span class="op">=</span><span class="dv">1</span>, dt<span class="op">=</span><span class="fl">0.1</span>, steps<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.Da <span class="op">=</span> Da</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.Db <span class="op">=</span> Db</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.Ra <span class="op">=</span> Ra</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.Rb <span class="op">=</span> Rb</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.initialiser <span class="op">=</span> initialiser</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.width <span class="op">=</span> width</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.height <span class="op">=</span> height</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.shape <span class="op">=</span> (width, height)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.dx <span class="op">=</span> dx</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.dt <span class="op">=</span> dt</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.steps <span class="op">=</span> steps</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> initialise(<span class="va">self</span>):</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.t <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.a, <span class="va">self</span>.b <span class="op">=</span> <span class="va">self</span>.initialiser(<span class="va">self</span>.shape)</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> update(<span class="va">self</span>):</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.steps):</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.t <span class="op">+=</span> <span class="va">self</span>.dt</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._update()</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _update(<span class="va">self</span>):</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># unpack so we don't have to keep writing "self"</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>        a,b,Da,Db,Ra,Rb,dt,dx <span class="op">=</span> (</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.a, <span class="va">self</span>.b,</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.Da, <span class="va">self</span>.Db,</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.Ra, <span class="va">self</span>.Rb,</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.dt, <span class="va">self</span>.dx</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>        La <span class="op">=</span> laplacian2D(a, dx)</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>        Lb <span class="op">=</span> laplacian2D(b, dx)</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>        delta_a <span class="op">=</span> dt <span class="op">*</span> (Da <span class="op">*</span> La <span class="op">+</span> Ra(a,b))</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>        delta_b <span class="op">=</span> dt <span class="op">*</span> (Db <span class="op">*</span> Lb <span class="op">+</span> Rb(a,b))</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.a <span class="op">+=</span> delta_a</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.b <span class="op">+=</span> delta_b</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> draw(<span class="va">self</span>, ax):</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>        ax[<span class="dv">0</span>].clear()</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>        ax[<span class="dv">1</span>].clear()</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>        ax[<span class="dv">0</span>].imshow(<span class="va">self</span>.a, cmap<span class="op">=</span><span class="st">'jet'</span>)</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>        ax[<span class="dv">1</span>].imshow(<span class="va">self</span>.b, cmap<span class="op">=</span><span class="st">'brg'</span>)</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>        ax[<span class="dv">0</span>].grid(visible<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>        ax[<span class="dv">1</span>].grid(visible<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>        ax[<span class="dv">0</span>].set_title(<span class="st">"A, t = </span><span class="sc">{:.2f}</span><span class="st">"</span>.<span class="bu">format</span>(<span class="va">self</span>.t))</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>        ax[<span class="dv">1</span>].set_title(<span class="st">"B, t = </span><span class="sc">{:.2f}</span><span class="st">"</span>.<span class="bu">format</span>(<span class="va">self</span>.t))</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> initialise_figure(<span class="va">self</span>):</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>        fig, ax <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">1</span>, ncols<span class="op">=</span><span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">6</span>))</span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> fig, ax</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>Da, Db, alpha, beta <span class="op">=</span> <span class="dv">1</span>, <span class="dv">100</span>, <span class="op">-</span><span class="fl">0.015</span>, <span class="dv">10</span></span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Ra(a,b): <span class="cf">return</span> a <span class="op">-</span> a <span class="op">**</span> <span class="dv">3</span> <span class="op">-</span> b <span class="op">+</span> alpha</span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Rb(a,b): <span class="cf">return</span> (a <span class="op">-</span> b) <span class="op">*</span> beta</span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>width <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>dx <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> <span class="fl">0.001</span></span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>TwoDimensionalRDEquations(</span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>    Da, Db, Ra, Rb,</span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span>width, height<span class="op">=</span>width,</span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>    dx<span class="op">=</span>dx, dt<span class="op">=</span>dt, steps<span class="op">=</span><span class="dv">100</span></span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>).plot_evolution_outcome(<span class="st">"2dRD.png"</span>, n_steps<span class="op">=</span><span class="dv">150</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="http://www.degeneratestate.org/static/turing-patterns/2dRD.gif"><img src="http://www.degeneratestate.org/static/turing-patterns/2dRD.png" class="img-fluid figure-img" alt="reaction"></a></p>
<figcaption>reaction</figcaption>
</figure>
</div>
<p>(It is possible to animate the formation of these patterns using a similar method call as in the one-dimensional case above. The resulting gifs are quite impressive, but also large, so they are not directly included here. However, if you click on the image it will take you to the animation)</p>
<p>It turns out this behaviour is common to a lot of reaction-diffusion equations, not just the ones presented here.</p>
<p>So how does this happen? To understand, we are going to need to do some maths.</p>
</section>
<section id="stability-analysis" class="level2">
<h2 class="anchored" data-anchor-id="stability-analysis"><em>Stability Analysis</em></h2>
<p>Let’s return to the original equations. We’ve seen that for certain conditions, pattern formations occurs.</p>
<p>Unfortunately, solving the equations directly for non-linear reaction functions is often not possible. Instead we can look at what happens when the the system is perturbed slightly from equilibrium.</p>
<section id="linearising-the-equations" class="level3">
<h3 class="anchored" data-anchor-id="linearising-the-equations"><em>Linearising the Equations</em></h3>
<p>We start by assuming there is some concentrations, <span class="math inline">\(a_{0}\)</span> and <span class="math inline">\(b_{0}\)</span>, for which the system is stable. This means that - <span class="math inline">\(R_{a}(a_{0},b_{0}) = 0\)</span> - <span class="math inline">\(R_{b}(a_{0},b_{0}) = 0\)</span></p>
<p>Around these solutions, we look at the time dependence of small perturbations around these values - <span class="math inline">\(x = a - a_{0}\)</span> - <span class="math inline">\(y = b - b_{0}\)</span></p>
<p>And linearise the reaction equations - <span class="math inline">\(R_{a}(a,b) \approx r_{aa}x + r_{ab}y\)</span> - <span class="math inline">\(R_{b}(a,b) \approx r_{ba}x + r_{bb}y\)</span></p>
<p>where <span class="math inline">\(r_{ij} = \frac{\partial R_{i}}{\partial j}\)</span>.</p>
<p>These approximations give us a set of linear equations, written in vector form as</p>
<p><span class="math inline">\(\dot{\mathbf{x}} = D\nabla^{2} \mathbf{x} + R \mathbf{x}\)</span></p>
<p>Where <span class="math inline">\(R = \left(\begin{matrix} r_{11} &amp; r_{12} \\ r_{21} &amp; r_{22}\end{matrix}\right)\)</span> and <span class="math inline">\(D = \left(\begin{matrix} D_{a} &amp; 0 \\ 0 &amp; D_{b}\end{matrix}\right)\)</span></p>
</section>
<section id="fourier-transform" class="level3">
<h3 class="anchored" data-anchor-id="fourier-transform"><em>Fourier Transform</em></h3>
<p>If we impose periodic boundary conditions to this equation, a natural solution can be found by applying a <a href="https://acko.net/files/gltalks/toolsforthought/">Fourier Transformation</a> to <span class="math inline">\(\mathbf{x}\)</span>. If we call the reciprocal coordinate <span class="math inline">\(k\)</span>, and the Fourier transform of <span class="math inline">\(\mathbf{x}\)</span> as <span class="math inline">\(\tilde{\mathbf{x}}\)</span>, then the transformed equation is</p>
<p><span class="math inline">\(\dot{\tilde{\mathbf{x}}} = (R - k^{2}D) \tilde{\mathbf{x}}\)</span></p>
<p>Which, has solutions of the form</p>
<p><span class="math inline">\(\tilde{\mathbf{x}}(t) = \tilde{\mathbf{x}}(0) e^{\omega t}\)</span></p>
<p>To find <span class="math inline">\(\omega\)</span> we plug this solution back into our transformed equation to get</p>
<p><span class="math inline">\(\omega \tilde{\mathbf{x}} = (R - k^{2}D) \tilde{\mathbf{x}}\)</span></p>
<p>Showing that <span class="math inline">\(\omega\)</span> is just the eigenvalue of <span class="math inline">\((R - k^{2}D)\)</span>.</p>
</section>
<section id="stability" class="level3">
<h3 class="anchored" data-anchor-id="stability"><em>Stability</em></h3>
<p>We now have an equation for the time dependence of our system in the Fourier domain. Using it, we can now discuss what we mean by <em>stability</em>. Our system is considered stable if small perturbations around the homogeneous do not cause it to move further away from the stable solutions.</p>
<p>In terms of our solution, <span class="math inline">\(\tilde{\mathbf{x}}(0) e^{\omega t}\)</span>, stability means that the values of <span class="math inline">\(\omega\)</span> does not have positive real parts for all values of <span class="math inline">\(k\)</span>. If <span class="math inline">\(\omega\)</span> is negative, the perturbation will decay away. If <span class="math inline">\(\omega\)</span> is imaginary, it will oscillate around the stable state. However, if it is positive and real <em>any</em> small perturbation will grow exponentially, until a high order term of the reaction equation becomes important.</p>
<p>To find <span class="math inline">\(\omega\)</span>, we need to solve the equation</p>
<p>$(R - k^{2}D - I) = 0 $</p>
<p>Writing <span class="math inline">\(J = R - k^{2}D\)</span>, this equitation takes the form</p>
<p><span class="math inline">\(\omega^{2} - \omega\hbox{Tr}(J) + \hbox{Det}(J) = 0\)</span></p>
<p>Solving for <span class="math inline">\(\omega\)</span>, we get</p>
<p><span class="math inline">\(\omega = \frac{1}{2}(\hbox{Tr}(J) \pm \sqrt{\hbox{Tr}(J)^{2} - 4 \hbox{Det}(J) })\)</span></p>
</section>
<section id="conditions-for-instability" class="level3">
<h3 class="anchored" data-anchor-id="conditions-for-instability"><em>Conditions for (in)Stability</em></h3>
<p>From our initial assumption that there was a stable homogeneous state, we require that <span class="math inline">\(\omega\)</span> has negative real parts where <span class="math inline">\(k = 0\)</span>, which corresponds to the spatially homogeneous solution. For this to be true, we require that</p>
<ul>
<li><span class="math inline">\(\hbox{Tr}(R) &lt; 0\)</span></li>
<li><span class="math inline">\(\hbox{det}(R) &gt; 0\)</span></li>
</ul>
<p>Or, in terms of the components of <span class="math inline">\(R\)</span>: - <span class="math inline">\(r_{aa} + r_{bb} &lt; 0\)</span> - <span class="math inline">\(r_{aa}r_{bb} - r_{ab}r_{ba} &gt; 0\)</span></p>
<p>For an instability to now occur at finite wavelength, we need one of the following conditions to hold: - <span class="math inline">\(\hbox{Tr}(J) &gt; 0\)</span> - <span class="math inline">\(\hbox{det}(J) &lt; 0\)</span></p>
<p>Because <span class="math inline">\(\hbox{Tr}(J) = \hbox{Tr}(R) - k^{2}(d_{a} + d_{b})\)</span>, the first condition cannot hold for any real <span class="math inline">\(k\)</span>. This means the we require the second to hold, or, after a bit of algebra</p>
<p><span class="math inline">\(k^{4}d_{a}d_{b} - k^{2}(d_{a}r_{bb} + d_{b}r_{aa}) + (r_{aa}r_{bb} - r_{ab}r_{ba}) &lt; 0\)</span></p>
<p>for some real value of <span class="math inline">\(k\)</span>. Once again, we need to solve a quadratic equation. To do this we note that because <span class="math inline">\(k\)</span> needs to be real, <span class="math inline">\(k^{2}\)</span> must be positive. This means that at least one root of quadratic equation in <span class="math inline">\(k^{2}\)</span> needs to be positive and real. This condition is only met when</p>
<p><span class="math inline">\(d_{b}r_{aa} + d_{a}r_{bb} &gt; 2\sqrt{d_{a}d_{b}(r_{aa}r_{bb} - r_{ab}r_{ba})} &gt; 0\)</span></p>
<p>And that’s it. We’ve derived that conditions for the diffusion-reaction equations to be stable to small perturbations.</p>
<p>We can write the complete requirements as</p>
<ol type="1">
<li><span class="math inline">\(r_{aa} + r_{bb} &lt; 0\)</span></li>
<li><span class="math inline">\(r_{aa}r_{bb} - r_{ab}r_{ba} &gt; 0\)</span></li>
<li><span class="math inline">\(d_{b}r_{aa} + d_{a}r_{bb} &gt; 2\sqrt{d_{a}d_{b}(r_{aa}r_{bb} - r_{ab}r_{ba})} &gt; 0\)</span></li>
</ol>
</section>
<section id="discussion" class="level3">
<h3 class="anchored" data-anchor-id="discussion"><em>Discussion</em></h3>
<p>We’ve waded through a lot of maths to reach this point. Let’s take stock of what we can make of the conditions for instability that we have derived.</p>
<p>Given the diffusion coefficients are positive, from the first and third equation above, we know that <span class="math inline">\(r_{aa}\)</span> and <span class="math inline">\(r_{bb}\)</span> have to have different signs, and the component with the negative sign has to be larger. Combining this we the second equation we know that either <span class="math inline">\(r_{ab}\)</span> or <span class="math inline">\(r_{ba}\)</span> has to be negative, and the other has to be positive. This two facts show why some systems like this are called activator-inhibitor system: the presence of one component increase the production of itself - the other inhibits the production of both.</p>
<p>With this information, the third equation shows us that the diffusion coefficients need to be different. Specifically, the diffusion coefficient of the inhibitor has to be larger then that of the activator.</p>
<p>Together, this gives us a hand-waving explanation of what might be going on: Consider starting with a small increase in the activator at some point. This in turn creates an increase in the inhibitor at that point. Both of these chemical diffuse to nearby points, but the inhibitor diffuses faster, lowering the activator concentration of nearby points. This lowering of the activator concentration at nearby points, which in turn lowers the inhibitor concentration. The disturbance spreads out like a wave.</p>
<p>It is a lot easier to get a feel for what’s going on once we visualise the this perturbation:</p>
<div id="cell-20" class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>Da, Db, alpha, beta <span class="op">=</span> <span class="dv">1</span>, <span class="dv">100</span>, <span class="op">-</span><span class="fl">0.005</span>, <span class="dv">10</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Ra(a,b): <span class="cf">return</span> a <span class="op">-</span> a <span class="op">**</span> <span class="dv">3</span> <span class="op">-</span> b <span class="op">+</span> alpha</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Rb(a,b): <span class="cf">return</span> (a <span class="op">-</span> b) <span class="op">*</span> beta</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> initalise_bump(shape):</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    a  <span class="op">=</span> np.zeros(shape)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(a.shape) <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        a[<span class="bu">int</span>(a.shape[<span class="dv">0</span>] <span class="op">/</span> <span class="dv">2</span>)] <span class="op">=</span> <span class="fl">0.3</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">len</span>(a.shape) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        a[<span class="bu">int</span>(a.shape[<span class="dv">0</span>] <span class="op">/</span> <span class="dv">2</span>), <span class="bu">int</span>(a.shape[<span class="dv">1</span>] <span class="op">/</span> <span class="dv">2</span>)] <span class="op">=</span> <span class="fl">0.3</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>        a,</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>        np.zeros(shape)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>width <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>dx <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> <span class="fl">0.001</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>OneDimensionalRDEquations(</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    Da, Db, Ra, Rb,</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    initialiser<span class="op">=</span>initalise_bump,</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span>width, dx<span class="op">=</span>dx, dt<span class="op">=</span>dt,</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    steps<span class="op">=</span><span class="dv">250</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>).plot_time_evolution(<span class="st">"1dRD_initial_bump.gif"</span>, n_steps<span class="op">=</span><span class="dv">150</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="http://www.degeneratestate.org/static/turing-patterns/1dRD_initial_bump.gif" class="img-fluid figure-img"></p>
<figcaption>reaction</figcaption>
</figure>
</div>
</section>
<section id="exploring-the-parameter-space" class="level3">
<h3 class="anchored" data-anchor-id="exploring-the-parameter-space"><em>Exploring the Parameter Space</em></h3>
<p>It is interesting to ask how the parameters of the equations affect the pattern formation. To get a feel for what this dependence is, we can investigate the amplitude of the instability for different frequencies. Close to equilibrium, we expect the frequency with the largest real component to dominate the dynamics of the system.</p>
<p>Calculating this value isn’t mathematically difficult: we have an equation of the amplitude <span class="math inline">\(\omega\)</span> in terms of the frequency <span class="math inline">\(k\)</span> above. Differentiating an equation of this size by hand can become tedious due to its size, and it is easy to introduce errors. And why carry out simple replacement steps when we have a computer to hand?</p>
<p>In the following, I use the computer algebra system <a href="http://www.sympy.org/en/index.html">sympy</a> to find the largest real mode of the system</p>
<div id="cell-23" class="cell" data-outputid="81184f71-e491-43dc-a12b-970ffd1b3726">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sympy <span class="im">as</span> sp</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>sp.init_printing()</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># define symbols</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>a,b,alpha,beta <span class="op">=</span> sp.symbols(<span class="st">"a,b,alpha,beta"</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>Raa, Rab, Rba, Rbb <span class="op">=</span> sp.symbols(<span class="st">"Raa, Rab, Rba, Rbb"</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>Da, Db <span class="op">=</span> sp.symbols(<span class="st">"Da, Db"</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>k2 <span class="op">=</span> sp.Symbol(<span class="st">"k2"</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co"># create matricies</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>R <span class="op">=</span> sp.Matrix(</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    [[Raa, Rab],</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>     [Rba, Rbb]]</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>D <span class="op">=</span> sp.Matrix(</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    [[Da, <span class="dv">0</span>],</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>     [<span class="dv">0</span>, Db]]</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>J <span class="op">=</span> (R <span class="op">-</span> k2 <span class="op">*</span> D)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="co"># define our solution for omega</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>omega <span class="op">=</span> sp.Matrix.trace(J) <span class="op">+</span> sp.sqrt(sp.Matrix.trace(J) <span class="op">**</span> <span class="dv">2</span> <span class="op">-</span> <span class="dv">4</span> <span class="op">*</span> sp.Matrix.det(J))</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>omega</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="8">
<p><span class="math display">\[- Da k_{2} - Db k_{2} + Raa + Rbb + \sqrt{- 4 Da Db k_{2}^{2} + 4 Da Rbb k_{2} + 4 Db Raa k_{2} - 4 Raa Rbb + 4 Rab Rba + \left(- Da k_{2} - Db k_{2} + Raa + Rbb\right)^{2}}\]</span></p>
</div>
</div>
<div id="cell-24" class="cell" data-outputid="786b5800-5dc8-4641-bd9c-b5110d5ceb31">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># find the maximum value of omega for k^{2}</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>omega_prime <span class="op">=</span> sp.diff(omega, k2)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>sols <span class="op">=</span> sp.solvers.solve(omega_prime, k2)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>max_k2 <span class="op">=</span> sols[<span class="dv">0</span>]</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>max_k2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="9">
<p><span class="math display">\[\frac{1}{Da Db \left(Da - Db\right)} \left(Da Db Raa - Da Db Rbb - Da \sqrt{- Da Db Rab Rba} - Db \sqrt{- Da Db Rab Rba}\right)\]</span></p>
</div>
</div>
<div id="cell-25" class="cell" data-outputid="05cfdc87-1b7e-49d2-99f6-9644a36730a2">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_length_scale(al, be, da, db):</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># rewritng in terms of Da, Db, alpha, beta</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    Ra <span class="op">=</span> a <span class="op">-</span> a<span class="op">**</span><span class="dv">3</span> <span class="op">-</span> b <span class="op">+</span> alpha</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    Rb <span class="op">=</span> beta <span class="op">*</span> (a <span class="op">-</span> b)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># we expand around the homogenius steady state</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    zero_subs <span class="op">=</span> [</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>        (a, sp.sign(alpha) <span class="op">*</span> sp.cbrt(sp.Abs(alpha))),</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>        (b, sp.sign(alpha) <span class="op">*</span> sp.cbrt(sp.Abs(alpha)))</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># and linearise</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    R_prime_subs <span class="op">=</span> {</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        (Raa, sp.diff(Ra, a)),</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>        (Rab, sp.diff(Ra, b)),</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>        (Rba, sp.diff(Rb, a)),</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>        (Rbb, sp.diff(Rb, b))</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># putting in our numeric values we get</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    vals <span class="op">=</span> [</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>        (alpha, al),</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>        (beta, be),</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>        (Da, da),</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>        (Db, db)</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># substitute it all in to find the maximum k</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>    max_k2 <span class="op">=</span> [sp.N(</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>        sol</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>        .subs(R_prime_subs)</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>        .subs(zero_subs)</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>        .subs(vals)</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>    ) <span class="cf">for</span> sol <span class="kw">in</span> sols]</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>    k2 <span class="op">=</span> <span class="bu">max</span>(sp.re(sym) <span class="cf">for</span> sym <span class="kw">in</span> max_k2)</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if k2 is negative, no real solution exists</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> k2 <span class="op">&lt;=</span> <span class="dv">0</span>:</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convert k2 into length units</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sp.N(<span class="dv">2</span> <span class="op">*</span> sp.pi <span class="op">/</span> sp.sqrt(k2))</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>get_length_scale(<span class="op">-</span><span class="fl">0.005</span>, <span class="dv">10</span>, <span class="dv">1</span>, <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="10">
<p><span class="math display">\[13.6336345738685\]</span></p>
</div>
</div>
<p>Which looks about right when we compare it to our simulations above - the spatial variation is about 14 length units.</p>
<p>Let’s use it to see how the length scale of the system changes as a function of <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>:</p>
<div id="cell-27" class="cell" data-outputid="51976567-7226-4591-f4e6-f01ccf4749f5">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>betas <span class="op">=</span> [(<span class="dv">1</span> <span class="op">+</span> i) <span class="op">*</span> <span class="fl">0.125</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">40</span>)]</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>alphas <span class="op">=</span> [i <span class="op">*</span> <span class="fl">0.05</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="op">-</span><span class="dv">20</span>,<span class="dv">20</span>)]</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>outcomes <span class="op">=</span> np.zeros((<span class="bu">len</span>(betas), <span class="bu">len</span>(alphas)))</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x,al <span class="kw">in</span> <span class="bu">enumerate</span>(alphas):</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> y,be <span class="kw">in</span> <span class="bu">enumerate</span>(betas):</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>        outcomes[y,x] <span class="op">=</span> get_length_scale(al, be, <span class="dv">1</span>, <span class="dv">100</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>))</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>o <span class="op">=</span> outcomes</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>o[outcomes <span class="op">==</span> <span class="dv">0</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>plt.imshow(o, cmap<span class="op">=</span><span class="st">"hsv"</span>, interpolation<span class="op">=</span><span class="st">"none"</span>)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>plt.colorbar()</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>plt.xticks(<span class="op">*</span><span class="bu">zip</span>(<span class="op">*</span>[(n,l) <span class="cf">for</span> n,l <span class="kw">in</span> <span class="bu">enumerate</span>(alphas) <span class="cf">if</span> n <span class="op">%</span> <span class="dv">5</span> <span class="op">==</span> <span class="dv">0</span>]), rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>plt.yticks(<span class="op">*</span><span class="bu">zip</span>(<span class="op">*</span>[(n,l) <span class="cf">for</span> n,l <span class="kw">in</span> <span class="bu">enumerate</span>(betas) <span class="cf">if</span> n <span class="op">%</span> <span class="dv">5</span> <span class="op">==</span> <span class="dv">0</span>]), rotation<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Lengthscale"</span>, fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="vs">r"$\alpha$"</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="vs">r"$\beta$"</span>, fontsize<span class="op">=</span><span class="dv">18</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="turing_patterns_files/figure-html/cell-12-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>And take a look at the long length scale we should see when we use a low value of <span class="math inline">\(\beta\)</span>:</p>
<div id="cell-29" class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>Da, Db, alpha, beta <span class="op">=</span> <span class="dv">1</span>, <span class="dv">100</span>, <span class="fl">0.01</span>, <span class="fl">0.25</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Ra(a,b): <span class="cf">return</span> a <span class="op">-</span> a <span class="op">**</span> <span class="dv">3</span> <span class="op">-</span> b <span class="op">+</span> alpha</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Rb(a,b): <span class="cf">return</span> (a <span class="op">-</span> b) <span class="op">*</span> beta</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>width <span class="op">=</span> <span class="dv">200</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>dx <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> <span class="fl">0.001</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>TwoDimensionalRDEquations(</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    Da, Db, Ra, Rb,</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span>width, height<span class="op">=</span>width,</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    dx<span class="op">=</span>dx, dt<span class="op">=</span>dt, steps<span class="op">=</span><span class="dv">150</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>).plot_evolution_outcome(<span class="st">"2dRD_small_beta.png"</span>, n_steps<span class="op">=</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="http://www.degeneratestate.org/static/turing-patterns/2dRD_small_beta.gif"><img src="http://www.degeneratestate.org/static/turing-patterns/2dRD_small_beta.png" class="img-fluid figure-img" alt="reaction"></a></p>
<figcaption>reaction</figcaption>
</figure>
</div>
</section>
<section id="initial-conditions" class="level3">
<h3 class="anchored" data-anchor-id="initial-conditions"><em>Initial Conditions</em></h3>
<p>Adjusting the parameters gives us control over the length scale of the system. We can also gain some control over the system by adjusting the initial conditions of the system. For example, we can impose symmetries on the system by making the initial conditions symmetric:</p>
<div id="cell-31" class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.ndimage.interpolation <span class="im">import</span> rotate</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> average_rotate(a, degree):</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Takes a 2d array a, and produces the average arrays,</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co">    having rotated it degree times. The resulting shape</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co">    has approximate degree-fold rotational symmetry.</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    theta <span class="op">=</span> <span class="dv">360</span> <span class="op">/</span> degree</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> np.mean([rotate(a, theta <span class="op">*</span> i, reshape<span class="op">=</span><span class="va">False</span>) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(degree)], axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> random_symmetric_initialiser(shape, degree):</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co">    Random initialiser with degree-fold symmetry.</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> np.random.normal(loc<span class="op">=</span><span class="dv">0</span>, scale<span class="op">=</span><span class="fl">0.05</span>, size<span class="op">=</span>shape)</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> np.random.normal(loc<span class="op">=</span><span class="dv">0</span>, scale<span class="op">=</span><span class="fl">0.05</span>, size<span class="op">=</span>shape)</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>        average_rotate(a, degree),</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>        average_rotate(b, degree)</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>Da, Db, alpha, beta <span class="op">=</span> <span class="dv">1</span>, <span class="dv">100</span>, <span class="fl">0.01</span>, <span class="dv">1</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Ra(a,b): <span class="cf">return</span> a <span class="op">-</span> a <span class="op">**</span> <span class="dv">3</span> <span class="op">-</span> b <span class="op">+</span> alpha</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Rb(a,b): <span class="cf">return</span> (a <span class="op">-</span> b) <span class="op">*</span> beta</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>width <span class="op">=</span> <span class="dv">200</span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>dx <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> <span class="fl">0.001</span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a><span class="co"># three fold</span></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>three_fold_initialiser <span class="op">=</span> <span class="kw">lambda</span> shape: random_symmetric_initialiser(shape, <span class="dv">3</span>)</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>TwoDimensionalRDEquations(</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>    Da, Db, Ra, Rb,</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>    initialiser<span class="op">=</span>three_fold_initialiser,</span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span>width, height<span class="op">=</span>width,</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>    dx<span class="op">=</span>dx, dt<span class="op">=</span>dt, steps<span class="op">=</span><span class="dv">250</span></span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>).plot_evolution_outcome(<span class="st">"2dRD_3_fold_sym.png"</span>, n_steps<span class="op">=</span><span class="dv">150</span>)</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a><span class="co"># five fold</span></span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>five_fold_initialiser <span class="op">=</span> <span class="kw">lambda</span> shape: random_symmetric_initialiser(shape, <span class="dv">5</span>)</span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>TwoDimensionalRDEquations(</span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>    Da, Db, Ra, Rb,</span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>    initialiser<span class="op">=</span>five_fold_initialiser,</span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span>width, height<span class="op">=</span>width,</span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>    dx<span class="op">=</span>dx, dt<span class="op">=</span>dt, steps<span class="op">=</span><span class="dv">250</span></span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>).plot_evolution_outcome(<span class="st">"2dRD_5_fold_sym.png"</span>, n_steps<span class="op">=</span><span class="dv">150</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Three fold rotational symmetry:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="http://www.degeneratestate.org/static/turing-patterns/2dRD_3_fold_sym.png" class="img-fluid figure-img"></p>
<figcaption>reaction</figcaption>
</figure>
</div>
<p>Five fold rotational symmetry:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="http://www.degeneratestate.org/static/turing-patterns/2dRD_5_fold_sym.png" class="img-fluid figure-img"></p>
<figcaption>reaction</figcaption>
</figure>
</div>
<p>The symmetry isn’t perfect due to implementing it one a square grid, but it works quite well.</p>
</section>
<section id="spatial-effects" class="level3">
<h3 class="anchored" data-anchor-id="spatial-effects"><em>Spatial Effects</em></h3>
<p>Another interesting extension to these systems is to see what happens when we allow the parameters of the system to vary in space. In our implementation, this is just a matter of making the parameters a grid as well:</p>
<div id="cell-33" class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>Da, Db, alpha, beta <span class="op">=</span> <span class="dv">1</span>, <span class="dv">100</span>, <span class="fl">0.01</span>, <span class="dv">10</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>width <span class="op">=</span> <span class="dv">200</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>dx <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> <span class="fl">0.001</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>x,y <span class="op">=</span> np.mgrid[<span class="dv">0</span>:width,<span class="dv">0</span>:width]</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>beta <span class="op">=</span> <span class="fl">0.1</span> <span class="op">+</span> <span class="dv">5</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">+</span> np.sin(<span class="dv">2</span> <span class="op">*</span> np.pi <span class="op">*</span> y <span class="op">/</span> <span class="dv">50</span>)) <span class="op">*</span> (<span class="dv">1</span> <span class="op">+</span> np.sin(<span class="dv">2</span> <span class="op">*</span> np.pi <span class="op">*</span> x <span class="op">/</span> <span class="dv">50</span>))</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Ra(a,b): <span class="cf">return</span> a <span class="op">-</span> a <span class="op">**</span> <span class="dv">3</span> <span class="op">-</span> b <span class="op">+</span> alpha</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Rb(a,b): <span class="cf">return</span> (a <span class="op">-</span> b) <span class="op">*</span> beta</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>TwoDimensionalRDEquations(</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    Da, Db, Ra, Rb,</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span>width, height<span class="op">=</span>width,</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    dx<span class="op">=</span>dx, dt<span class="op">=</span>dt, steps<span class="op">=</span><span class="dv">100</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>).plot_evolution_outcome(<span class="st">"2dRD_spatial.png"</span>, n_steps<span class="op">=</span><span class="dv">200</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="http://www.degeneratestate.org/static/turing-patterns/2dRD_spatial.gif"><img src="http://www.degeneratestate.org/static/turing-patterns/2dRD_spatial.png" class="img-fluid figure-img" alt="reaction"></a></p>
<figcaption>reaction</figcaption>
</figure>
</div>
</section>
</section>
<section id="similar-systems" class="level2">
<h2 class="anchored" data-anchor-id="similar-systems"><em>Similar Systems</em></h2>
<p>Turing patterns are only one part of pattern generation from non-linear PDEs. Given we have the tools to explore these systems, it is worth looking at another simple system in which pattern formation occurs: <a href="https://groups.csail.mit.edu/mac/projects/amorphous/GrayScott/">the Gray-Scott equations</a>. As described in the paper <a href="http://www.staff.science.uu.nl/~frank011/Classes/complexity/Literature/Pearson.pdf">Complex Patterns in a Simple System</a>, for an interesting set of initial conditions the Gray-Scott equations result in a range complex patterns being formed.</p>
<p>While these equations <em>are</em> reaction-diffusion equations, the patterns that end up being formed are not from Turing instabilities. Instead they come from the initial conditions of the system: a small region in the centre of the region is perturbed. As this perturbation spreads out, strange patterns are formed.</p>
<p>To visualise it, we just need to pass another initialisation function of our previous class, and put in new reaction equations. The parameters for the interesting systems are taken from <a href="http://www.aliensaint.com/uo/java/rd/">here</a>. I’m not currently aware of any theory that gives a full explanation of these patterns.</p>
<div id="cell-36" class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gs_initialiser(shape):</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>        a <span class="op">=</span> np.ones(shape)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>        b <span class="op">=</span> np.zeros(shape)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>        centre <span class="op">=</span> <span class="bu">int</span>(shape[<span class="dv">0</span>] <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>        a[centre<span class="op">-</span><span class="dv">20</span>:centre<span class="op">+</span><span class="dv">20</span>,centre<span class="op">-</span><span class="dv">20</span>:centre<span class="op">+</span><span class="dv">20</span>] <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>        b[centre<span class="op">-</span><span class="dv">20</span>:centre<span class="op">+</span><span class="dv">20</span>,centre<span class="op">-</span><span class="dv">20</span>:centre<span class="op">+</span><span class="dv">20</span>] <span class="op">=</span> <span class="fl">0.25</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>        a <span class="op">+=</span> np.random.normal(scale<span class="op">=</span><span class="fl">0.05</span>, size<span class="op">=</span>shape)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>        b <span class="op">+=</span> np.random.normal(scale<span class="op">=</span><span class="fl">0.05</span>, size<span class="op">=</span>shape)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> a,b</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co"># interesting parameters taken from http://www.aliensaint.com/uo/java/rd/</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> [</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">0.16</span>, <span class="fl">0.08</span>, <span class="fl">0.035</span>, <span class="fl">0.065</span>],</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">0.14</span>, <span class="fl">0.06</span>, <span class="fl">0.035</span>, <span class="fl">0.065</span>],</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">0.16</span>, <span class="fl">0.08</span>, <span class="fl">0.06</span>, <span class="fl">0.062</span>],</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">0.19</span>, <span class="fl">0.05</span>, <span class="fl">0.06</span>, <span class="fl">0.062</span>],</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">0.16</span>, <span class="fl">0.08</span>, <span class="fl">0.02</span>, <span class="fl">0.055</span>],</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">0.16</span>, <span class="fl">0.08</span>, <span class="fl">0.05</span>, <span class="fl">0.065</span>],</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">0.16</span>, <span class="fl">0.08</span>, <span class="fl">0.054</span>, <span class="fl">0.063</span>],</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">0.16</span>, <span class="fl">0.08</span>, <span class="fl">0.035</span>, <span class="fl">0.06</span>]</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, param <span class="kw">in</span> <span class="bu">enumerate</span>(params):</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>    Da, Db, f, k <span class="op">=</span> param</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> Ra(a,b): <span class="cf">return</span> <span class="op">-</span> a<span class="op">*</span>b<span class="op">*</span>b <span class="op">+</span> f<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>a)</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> Rb(a,b): <span class="cf">return</span> <span class="op">+</span> a<span class="op">*</span>b<span class="op">*</span>b <span class="op">-</span> (f<span class="op">+</span>k)<span class="op">*</span>b</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>    width <span class="op">=</span> <span class="dv">200</span></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>    dx <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>    dt <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>    TwoDimensionalRDEquations(</span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>        Da, Db, Ra, Rb,</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>        initialiser<span class="op">=</span>gs_initialiser,</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>        width<span class="op">=</span>width, height<span class="op">=</span>width,</span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>        dx<span class="op">=</span>dx, dt<span class="op">=</span>dt, steps<span class="op">=</span><span class="dv">200</span></span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>    ).plot_evolution_outcome(<span class="st">"gs_</span><span class="sc">{}</span><span class="st">.png"</span>.<span class="bu">format</span>(i), n_steps<span class="op">=</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="http://www.degeneratestate.org/static/turing-patterns/gs_0.gif"><img src="http://www.degeneratestate.org/static/turing-patterns/gs_0.png" class="img-fluid figure-img" alt="reaction"></a></p>
<figcaption>reaction</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="http://www.degeneratestate.org/static/turing-patterns/gs_1.gif"><img src="http://www.degeneratestate.org/static/turing-patterns/gs_1.png" class="img-fluid figure-img" alt="reaction"></a></p>
<figcaption>reaction</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="http://www.degeneratestate.org/static/turing-patterns/gs_2.gif"><img src="http://www.degeneratestate.org/static/turing-patterns/gs_2.png" class="img-fluid figure-img" alt="reaction"></a></p>
<figcaption>reaction</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="http://www.degeneratestate.org/static/turing-patterns/gs_3.gif"><img src="http://www.degeneratestate.org/static/turing-patterns/gs_3.png" class="img-fluid figure-img" alt="reaction"></a></p>
<figcaption>reaction</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="http://www.degeneratestate.org/static/turing-patterns/gs_4.gif"><img src="http://www.degeneratestate.org/static/turing-patterns/gs_4.png" class="img-fluid figure-img" alt="reaction"></a></p>
<figcaption>reaction</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="http://www.degeneratestate.org/static/turing-patterns/gs_5.gif"><img src="http://www.degeneratestate.org/static/turing-patterns/gs_5.png" class="img-fluid figure-img" alt="reaction"></a></p>
<figcaption>reaction</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="http://www.degeneratestate.org/static/turing-patterns/gs_6.gif"><img src="http://www.degeneratestate.org/static/turing-patterns/gs_6.png" class="img-fluid figure-img" alt="reaction"></a></p>
<figcaption>reaction</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="http://www.degeneratestate.org/static/turing-patterns/gs_7.gif"><img src="http://www.degeneratestate.org/static/turing-patterns/gs_7.png" class="img-fluid figure-img" alt="reaction"></a></p>
<figcaption>reaction</figcaption>
</figure>
</div>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion"><em>Conclusion</em></h2>
<p>It’s been interesting to play with these non-linear systems. One of the main challenges I’ve found with looking at them is how you find “interesting” parameters. I have some ideas about how we might search for these automatically, but that will have to wait for another post.</p>
<p>The complexity that can arise from these simple systems surprised me at fist, but it <a href="http://schulmanlab.jhu.edu/papers/reaction-diffusion-ca-journal-version.pdf">has been shown</a> that it is possible to encode cellular automata in reaction diffusion systems. This suggests that the patterns formed by reaction-diffusion systems can be as complex as those produced by any Turing-complete system, and that any attempt to provide a quantitative explanation for their full behaviour will eventually run into some undecidable statement.</p>
<p>And with that connection between Turing’s work on reaction-diffusion equations and his more well known work on computability, I think it’s time to end this post.</p>
</section>
<section id="code" class="level2">
<h2 class="anchored" data-anchor-id="code"><em>Code</em></h2>
<p>This post was created from a jupyter notebook. You can find it <a href="https://github.com/ijmbarr/turing-patterns">here</a>.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>